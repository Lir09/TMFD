<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>일정 관리 달력</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: linear-gradient(135deg, #747579, #494153);
  min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px;
}
.calendar-container {
  background: rgba(40,40,40,0.95);
  border-radius:20px; padding:30px;
  box-shadow:0 20px 40px rgba(0,0,0,0.5);
  max-width:900px; width:100%;
}
.calendar-header {
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:20px;
}
#monthYear { font-size:1.8em; color:#fff; }
.nav-button {
  background:none; border:none; font-size:24px; color:#fff;
  cursor:pointer; width:40px; height:40px; border-radius:50%;
  transition: background-color 0.3s ease, transform 0.2s ease;
}
.nav-button:hover {
  background:rgba(255,255,255,0.1);
  transform: scale(1.1);
}
#calendar table {
  width:100%; border-collapse:collapse; table-layout: fixed;
}
#calendar th, #calendar td {
  text-align:left; vertical-align:top; padding:5px; color:#fff;
  border:1px solid rgba(255,255,255,0.1); border-radius:8px;
}
#calendar td {
  height:80px; font-size:12px; position:relative;
  transition: background-color 0.3s ease, transform 0.2s ease;
  cursor: pointer;
}
#calendar td:hover {
  background-color: rgba(255,255,255,0.15);
  transform: scale(1.05);
  z-index: 1;
  position: relative;
}
#calendar td.selected {
  background-color: #4da6ff;
  color: white;
  box-shadow: 0 0 10px #4da6ff;
  transform: scale(1.1);
  transition: background-color 0.4s ease, transform 0.3s ease;
}
#calendar td .date-num { font-weight:bold; display:block; }
#calendar td .event-text {
  font-size:11px; margin-top:2px;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.today { background:#666; }
#eventBanner {
  margin-top:15px; padding:10px; color:#fff; text-align:center;
  transition: opacity 0.3s ease;
}
#downloadBtn {
  margin-top:10px; background-color:#4da6ff; border:none; color:white;
  padding:10px 20px; font-size:16px; border-radius:12px; cursor:pointer;
  display:none;
  transition: background-color 0.3s ease, transform 0.2s ease;
}
#downloadBtn:hover {
  background-color:#357acb;
  transform: scale(1.05);
}
#goIndexBtn {
  display: inline-block;
  margin-top: 12px;
  padding: 10px 20px;
  background-color: #4da6ff;
  color: white;
  font-weight: bold;
  border-radius: 12px;
  text-decoration: none;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.2s ease;
}
#goIndexBtn:hover {
  background-color: #357acb;
  transform: scale(1.05);
}

</style>
</head>
<body>
<div class="calendar-container">
  <div class="calendar-header">
    <button class="nav-button" id="prevMonth">‹</button>
    <div id="monthYear"></div>
    <button class="nav-button" id="nextMonth">›</button>
  </div>
  <div id="calendar"></div>
<div id="eventBanner">날짜를 선택하세요</div>
<a href="index.html" id="goIndexBtn">메인으로 돌아가기</a>
<button id="downloadBtn">.ics 파일 다운로드</button>
</div>


<script>
document.addEventListener('DOMContentLoaded', function(){
  const today=new Date();
  let currentMonth=today.getMonth(), currentYear=today.getFullYear();
  let selectedDate=null;

  // ✅ 일정 데이터 (원본 그대로)
  const events={
    '2025-03-12':'1학년 수련회','2025-03-13':'1학년 수련회','2025-03-14':'1학년 수련회',
    '2025-03-26':'전국연합학력평가','2025-04-29':'중간고사','2025-04-30':'중간고사',
    '2025-05-01':'중간고사','2025-05-02':'중간고사','2025-05-15':'현장체험학습',
    '2025-05-16':'체육대회','2025-05-29':'축제','2025-06-03':'전국연합학력평가 - 부산시',
    '2025-07-02':'기말고사','2025-07-03':'기말고사','2025-07-04':'기말고사',
    '2025-07-07':'기말고사','2025-07-08':'기말고사','2025-07-22':'방학식'
  };

  const examEvents={
    '2025-03-07':{title:'가짜 뉴스가 판치는 세상'},
    '2025-04-10':{title:'인지 부조화와 확증편향의 시대'},
    '2025-05-08':{title:'사람들은 왜 불합리한 권위 앞에서 순종하는가?'},
    '2025-05-29':{title:'중독은 개인의 책임인가 사회의 문제인가?'},
    '2025-06-12':{title:'우리가 기억하는 기억은 진짜 기억인가?'},
    '2025-03-31':{title:'시사 논술'},
    '2025-05-19':{title:'독서 탐구 계획서'},
    '2025-04-09':{title:'H.I.U.'},
    '2025-04-16':{title:'H.I.U.'},
    '2025-04-23':{title:'H.I.U.'},
    '2025-05-07':{title:'H.I.U.'},
    '2025-06-30':{title:'사료 검증 리포트'},
    '2025-07-11':{title:'인사이트 히스토리 노트'},
    '2025-04-21':{title:'과학 탐구 실험 1'},
    '2025-05-26':{title:'과학 탐구 실험 2'},
    '2025-04-06':{title:'HS4A project'},
    '2025-04-12':{title:'Class diary'}
  };

  const examAmounts={
    '가짜 뉴스가 판치는 세상':1,
    '인지 부조화와 확증편향의 시대':1,
    '사람들은 왜 불합리한 권위 앞에서 순종하는가?':1,
    '중독은 개인의 책임인가 사회의 문제인가?':1,
    '우리가 기억하는 기억은 진짜 기억인가?':1,
    '시사 논술':3,
    '독서 탐구 계획서':2,
    'H.I.U.':5,
    '사료 검증 리포트':3,
    '인사이트 히스토리 노트':4,
    '과학 탐구 실험 1':2,
    '과학 탐구 실험 2':2,
    'HS4A project':3,
    'Class diary':14
  };

  let distributedTasks={};

  function distributeTasks(){
    distributedTasks={};
    for(let dateStr in examEvents){
      const title=examEvents[dateStr].title, needDays=examAmounts[title]||0;
      const deadline=new Date(dateStr);
      for(let i=0;i<needDays;i++){
        const taskDate=new Date(deadline);
        taskDate.setDate(taskDate.getDate()-i-1);
        const y=taskDate.getFullYear(), m=String(taskDate.getMonth()+1).padStart(2,'0'), d=String(taskDate.getDate()).padStart(2,'0');
        distributedTasks[`${y}-${m}-${d}`]=`[${title}] 준비`;
      }
    }
  }

function generateCalendar(month,year){
  const firstDay=new Date(year,month,1).getDay(), daysInMonth=new Date(year,month+1,0).getDate();
  let html='<table><tr>';
  ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d=> html+=`<th>${d}</th>`);
  html+='</tr><tr>';
  for(let i=0;i<firstDay;i++) html+='<td></td>';
  for(let day=1;day<=daysInMonth;day++){
    const dateStr=`${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    let texts=[];

    if(examEvents[dateStr]) texts.push(examEvents[dateStr].title);
    if(distributedTasks[dateStr]) texts.push(distributedTasks[dateStr]);
    if(events[dateStr]) texts.push(events[dateStr]);

    html+=`<td class="${dateStr===getTodayStr()?'today':''}" data-date="${dateStr}">
      <span class="date-num">${day}</span>
      ${texts.map(text=>`<div class="event-text">${text}</div>`).join('')}
    </td>`;
    if((firstDay+day)%7===0) html+='</tr><tr>';
  }
  html+='</tr></table>';
  document.getElementById('calendar').innerHTML=html;
  document.getElementById('monthYear').textContent=`${year}-${String(month+1).padStart(2,'0')}`;
  document.querySelectorAll('#calendar td[data-date]').forEach(td=>{
    td.onclick=()=>{selectedDate=td.getAttribute('data-date'); updateBanner(selectedDate);}
  });
}


  function getTodayStr(){
    const d=new Date();
    return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
  }

function updateBanner(date){
  const banner=document.getElementById('eventBanner');
  const btn=document.getElementById('downloadBtn');
  let texts=[];

  if(examEvents[date]) texts.push(examEvents[date].title);
  if(distributedTasks[date]) texts.push(distributedTasks[date]);
  if(events[date]) texts.push(events[date]);

  if(texts.length>0){
    banner.innerHTML=texts.map(text=>`<div>${text}</div>`).join('');
    btn.style.display='inline-block';
  }else{
    banner.textContent='날짜를 선택하세요';
    btn.style.display='none';
  }
}


  function generateICS(dateStr,title){
    const dt=new Date(dateStr),dtEnd=new Date(dt); dtEnd.setDate(dt.getDate()+1);
    return `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//MyCalendar//EN
BEGIN:VEVENT
UID:${dateStr}@example.com
DTSTAMP:${dt.toISOString().replace(/[-:]|\.\d{3}/g,'')}Z
DTSTART;VALUE=DATE:${dateStr.replace(/-/g,'')}
DTEND;VALUE=DATE:${dtEnd.toISOString().slice(0,10).replace(/-/g,'')}
SUMMARY:${title}
END:VEVENT
END:VCALENDAR`;
  }

  document.getElementById('downloadBtn').onclick=()=>{
    if(!selectedDate)return;
    let title=examEvents[selectedDate]?.title||distributedTasks[selectedDate]||events[selectedDate]||'일정';
    const ics=generateICS(selectedDate,title);
    const blob=new Blob([ics],{type:'text/calendar;charset=utf-8'}),url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download=`Event_${selectedDate}.ics`;
    document.body.appendChild(a); a.click(); setTimeout(()=>{document.body.removeChild(a); URL.revokeObjectURL(url);},0);
  };

  document.getElementById('prevMonth').onclick=()=>{currentMonth--; if(currentMonth<0){currentMonth=11; currentYear--;} generateCalendar(currentMonth,currentYear);}
  document.getElementById('nextMonth').onclick=()=>{currentMonth++; if(currentMonth>11){currentMonth=0; currentYear++;} generateCalendar(currentMonth,currentYear);}

  distributeTasks(); generateCalendar(currentMonth,currentYear);
});
</script>
</body>
</html>
